<section class="green" data-type="chapter">
<header>
  <div class="icon"><img src="../images/sections/04/spreadsheet.png" /></div>
  <p>第七章</p>
  <h1>準備好你的資料讓它可被使用</h1>
  <p data-type="author">By Oz du Soleil</p>
</header>

<section data-type="sect1">
<p>從一個觀點上來看資料，該如何整理你的資料，好讓它成為可使用的資料，這件事情是難以學習和教導的。 當在處理資料時，你可能很常會遭遇到需要特別手法處理的資料。尤其是你正在處理別人所蒐集的資料，只有少部分的工作是共通的。 雖然許多 <a class="glossterm" target="_blank" href="glossary01.html#preparation-data">資料準備</a></a>的動作可以藉由電腦來代勞，但仍然有可觀數量的處理工作是需要經由人工判斷來決定哪些工作需要被執行。 因為這個原因，許多人都相當痛恨這個部份的工作，不過還是需要有個人來完成這項工作!</p>

<p>無論你是一個應對數十億筆資料的高收入數據分析師，還是一個只有90個聯系人名單的個人工作者，你都會在某個時候遇到凌亂的數據。 不幸的是，數據準備不是一個直覺性的任務，而且沒有一個絕對準確的方式進行。 每一個數據集都有其獨特之處，也許有些處理技巧在你的一生中，只會用到一次，正如下面你將會看到的例子。</p>


<h2>資料分離</h2>

<p>在資料準備的第一步最有用的方法就是將資料拆成各個不同的屬性欄位。</p>

<p>你是否曾經有過沒辦法直接從資料集裡取得你所需要的資訊的經驗? 也許是因為完整的地址都塞在同一個欄位，使得你沒有辦法對於特定的城市(City)或是州(State)進行數據統計。 也有可能是一個供應商給了你一張有6000個領件的清單，但是他們的編號系統中包含了 倉儲編號(warehouse code) 和 零件編號(part number) ，但你實際需要的只有零件編號。</p>

<table>
	<tbody>
		<tr>
			<th>您所想要的</th>
			<th>他們提供的</th>
		</tr>
		<tr>
			<td>C77000S</td>
			<td>GA3C77000S</td>
		</tr>
		<tr>
			<td>W30000P</td>
			<td>GA1W30000P</td>
		</tr>
		<tr>
			<td>D21250G</td>
			<td>DE1D21250G</td>
		</tr>
	</tbody>
</table>

<p>試著思考處理下面資料集的挑戰:</p>

<table>
	<tbody>
		<tr>
			<th>Mall</th>
			<th>Address</th>
			<th>City</th>
			<th>State</th>
		</tr>
		<tr>
			<td><b>Warm Willows Mall</b> Peters Road Marrison, MI</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td><b>Jaspers</b> Martinson &amp; Timberlake Rds Reed, FL</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td><b>Lara Lafayette Shoppes</b> 17 Industrial Drive Elm, CT</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
	</tbody>
</table>

<p>你需要商場的名字、地址、所在的州和城市，並將其分到不同的欄位中。這個資料集上百個商場，如果以手工操作的方式進行會需要大量時間。 商場的名字被加粗了，這樣從視覺上容易區分商場名字的結束點與地址的起始點，但不是所有的地址都以數字開始，所以沒有標准的方法將它分離到不同欄位。 盡管可以編寫程式，通過區分加粗字體和普通字體的權重將它們分離，但這畢竟是一種罕見的情形，而且你也不太可能手邊就有這樣的程式可以使用。 在這種狀況下，也許你編寫的程式（或者其他人為你編寫程式）永遠不會再次用於這種目的。</p>

<p>每種情形都有其獨特之處，因此在本章節我們沒辦法教你關於如何拆解所有資料資訊。 然而，仍然有些處理策略是在大多情形下是有效的。 我們將通過講解其中的一些策略和一些資料准備工作經常會面臨的挑戰及其成因，來幫助你開始學習數據准備。</p>

<h2>讓我們開始吧</h2>

<p>一個簡單的例子就是很多人遇到過的將姓氏與名字區分開來。你也許會得到一個資料集，其中全名在同個欄位下，你需要將姓氏和名字區分開，或者這個數據集包含單獨的姓氏欄位和名字欄位，但一些紀錄中全名出現在其中一個欄位裡。</p>

<table>
	<tbody>
		<tr>
			<td>全名在同個欄位下:
			<table>
				<tbody>
					<tr>
						<th>Name</th>
					</tr>
					<tr>
						<td>Keith Pallard</td>
					</tr>
					<tr>
						<td>Fumi Takano</td>
					</tr>
					<tr>
						<td>Rhonda Johnson</td>
					</tr>
					<tr>
						<td>Warren Andersen</td>
					</tr>
					<tr>
						<td>Juan Tyler</td>
					</tr>
					<tr>
						<td>Cicely Pope</td>
					</tr>
				</tbody>
			</table>
			</td>
			<td>兩個欄位, 但並非所有資料在正確欄位:
			<table>
				<tbody>
					<tr>
						<th>First Name</th>
						<th>Last Name</th>
					</tr>
					<tr>
						<td></td>
						<td>Keith Pallard</td>
					</tr>
					<tr>
						<td>Fumi Takano</td>
						<td></td>
					</tr>
					<tr>
						<td>Rhonda</td>
						<td>Johnson</td>
					</tr>
					<tr>
						<td>Warren Andersen</td>
						<td></td>
					</tr>
					<tr>
						<td>Juan</td>
						<td>Tyler</td>
					</tr>
					<tr>
						<td>Cicely</td>
						<td>Pope</td>
					</tr>
				</tbody>
			</table>
			</td>
		</tr>
	</tbody>
</table>

<p當我們遇到這類的數據時，問題似乎很好解決。有一些通用的方法將姓氏與名字區分開來（凱斯、福米和沃倫）。最簡單的方法是尋找空格，通過姓名間的空格將其劃分到不同的欄位，瞧！</p>

<p>這個例子非常簡單，但在實際工作中，我們面對的是更為復雜的情形。例如，你的資料集包含成千上萬的姓名。 手工分離姓名會花費你的大量時間，而且姓名並不僅僅是姓氏和名字那麼簡單，它有更為復雜的組合。</p>

<table>
	<tbody>
		<tr>
			<td>Middle Initials</td>
			<td>Martina C. Daniels</td>
		</tr>
		<tr>
			<td>Professional Designations</td>
			<td>Lloyd Carson DVM</td>
		</tr>
		<tr>
			<td>2-part Last Names</td>
			<td>Lora de Carlo</td>
		</tr>
		<tr>
			<td>Prefixes</td>
			<td>Rev Herman Phillips</td>
		</tr>
		<tr>
			<td>Suffixes</td>
			<td>Jimmy Walford III</td>
		</tr>
		<tr>
			<td>Hyphenated Last Names</td>
			<td>Tori Baker-Andersen</td>
		</tr>
		<tr>
			<td>Last Name First</td>
			<td>Kincaid Jr, Paul</td>
		</tr>
		<tr>
			<td>2-part First Names</td>
			<td>Ray Anne Lipscomb</td>
		</tr>
		<tr>
			<td>Prefixes/Suffixes</td>
			<td>Rev Rhonda-Lee St. Andrews-Fernandez, DD, MSW</td>
		</tr>
		<tr>
			<td>Other fields incorrectly included</td>
			<td>Murray Wilkins 993 E Plymouth Blvd</td>
		</tr>
		<tr>
			<td>No/Missing First Name</td>
			<td>O&rsquo;Connor</td>
		</tr>
		<tr>
			<td>No/Missing Last Name</td>
			<td>Tanya</td>
		</tr>
		<tr>
			<td>No name at all</td>
			<td></td>
		</tr>
		<tr>
			<td>I have no earthly idea!</td>
			<td>JJ</td>
		</tr>
		<tr>
			<td>Not a person&rsquo;s name at all</td>
			<td>North City Garden Supply</td>
		</tr>
	</tbody>
</table>

<h2>現在呢? 讓我們來做些決策</h2>

<p>假設現在我們有個 500 名字的清單面臨需要分離名字（數量大到難以人工進行操作），之後就能夠以姓氏進行分類。</p>

<p>在開始之前，我們需要弄清一些事情：</p>

<ul>
	<li>為什麼解析這個姓名欄位是如此的重要？如果姓氏跟名字在同一個欄位中，有任何不好的影響嗎？</li>
	<li>我們想要看到怎樣的結果？
	<ul>
		<li>保留敬稱是否重要，以及是否該特別建立一個欄位來存放博士、夫人、上尉...等這樣的敬稱？</li>
		<li>小”（Jr）是否應該姓氏保留在同一欄內，還是建立獨立的欄位？</li>
		<li>是否要保留中間名字的縮寫？或是建立中間姓名的單獨欄位，還是將它與名字放在一起，或與姓氏放在一起？</li>
		<li>我們是否要保存職業資訊？</li>
	</ul>
	</li>
	<li>做這些事情是否值得？對於簡單案例，你可能可以僱用某人來完成這樣的工作，但是這對於複雜的案例可能不是理想的解決方法。萬一有一個專業人士說他可以用 1000 美元的價格來處理這份清單呢？</li>
	<li>我們該如何處理不完整和不正確的項目？</li>
</ul>

<p>這些問題應該要在妳開始處理妳的資料前就該被回答。 如果你在不清楚的情況下就開始進行，你可能會造成更大的混亂。在執行前的決定是確實能夠讓流程更加簡單的，例如說，如果你決定職業資訊並不重要，也許有一種簡單的方法可以排除掉它以及簡單化專案的其他部分</p>

<p>假設你正在處理一張有 20,000 名字的清單，其中 19,400 來自於美國和 600 來自於土耳其。 在美國，敬稱是放在名字<em>前面</em> (例如: <strong>Mr.</strong> John Smith)，然而對於土耳其人，敬稱是放在名字<em>後面</em> (例如: Jon Smith <strong>Bey</strong>). 你正嘗試想找出是否需要為土耳其名字資料或是其他資料集進行欄位分離，所以你詢問你的客戶的需求。</p>

<p>他們的回答很簡單。 他們並沒有在土耳其拓展生意，所以並不在意你是否刪除掉這些紀錄。太好了！只剩下 19,400 筆資料。</p>

<h2>那麼現在我們該如何來拆解這些資料呢？</h2>

<p>有太多的技巧，多到我們可以寫一整本書來講這個主題。 你可以在 Excel 裡將資料剖析成各個部份，或是如果你有程式能力，你可以使用 Python、SQL 或是其它任何的程式語言。 有太多東西可以讓我們在這章節裡面探討，不過有一些不錯的參考可以看一下我們的<a href="app02.html">資源附錄</a>。 現在我們僅探討一些基本的初始策略，當你未來在準備好時，能夠可以更輕易的掌握那些參考。</p>

<div data-type="warning"><p><每當你要進行任何資料的準備或是清理前，你<em>一定</em>要複製一份你的資料集，假如你不小心做了錯誤的事，你會需要參考原始的資料。</p></div>

<figure><img alt="策略小提示" src="../images/sections/04/strategy-tips-flow.png" /></figure>

<h3>尋找出可輕易處理的目標</h3>

<p>在許多資料紀錄中，大多數需要被拆分的資料其實都很單純。 在 500 個名字當中，你可能找到 200 個僅只有名跟姓。 先把他們放一邊。 別管他們了。 然後僅關心剩下的 300 個姓名。</p>

<h3>辨識怪異目標</h3>

<p>清查你的資料集，查看是否沒名字、複雜的名字、不完整的名字、非人的名字或是任何項目是你不知道該如何處理的。先把他們放一邊。 我們假設這樣的項目大約有 40 個或是更多。</p>

<h3>尋找相似目標</h3>

<p>剩下的 260 個名字中，或許 60 個是因為在名字後面有多加上職業稱呼所以變得複雜。你可以選擇刪除這些職業稱呼或是將它們放到跟姓名區隔的個別欄位中。 現在這些職業稱呼已經被你分離(或是刪除)，你會擁有一個只有姓名的欄位 我們可以將這些分離完姓和名的紀錄加到我們一開始不理的 200 個姓名當中。</p>

<p>現在我們把分離的姓名資料和其它剩下的資料類型放到它們各自的群組裡。</p>

<h3>人工處理</h3>

<p>你一開始辨識出的 40 個怪異紀錄，依據它的怪異程度，你可能需要手動的重新輸入。</p>

<div data-type="note">
<p>有時當我們處理現實世界的資料，紀錄它本身是有被管理的。例如一個非名字的紀錄其實是一個完整重複的紀錄，我們僅需要刪除不正確的紀錄並繼續
</p>
</div>

<figure><img alt="Separating data workflow" src="../images/sections/04/separating-data-flow.png" /></figure>

<h2>常見的問題欄位</h2>

<p>依據資料如何被蒐集，也許除了姓名以外的欄位你會有興趣如何進行拆分‧一些常見的有：</p>

<ul>
	<li>
	<p>Address information</p>
	</li>
	<li>
	<p><span style="line-height: 1.5em;">電話號碼，尤其當你需要拆分出地區碼</span></p>
	</li>
	<li>
	<p><span style="line-height: 1.5em;">信箱，當你好奇他們的網域資訊</span></p>
	</li>
	<li>
	<p><span style="line-height: 1.5em;">日期，如果你只想要年或是月</span></p>
	</li>
</ul>

<h3>單位和單位轉換</h3>

<p>確認所有屬於同一個欄位的資料都要是相同的單位也是重要的資料準備工作之一。理想上，你可能會在表單輸入時強迫特定的單位型態，但是你可能是處理別人的資料集或是資料是直接從其他來源蒐集的，這些資料來源可能已經使用由機器編譯過的一些特定單位。例如你可能有一些從各個不同國家取得的醫療紀錄。紀錄中病人的體重單位可能是磅，但可能部份是公斤。將所有單位統一轉換成磅或是公斤，讓他們能夠有相同的刻度是相當重要的一件事情。否則這些紀錄是沒辦法直接相互進行比較，任何的數據視覺化都會讓資料看起來很奇怪。</p>

<figure><img alt="Kilos and pounds in the same chart" src="../images/sections/04/kilos-vs-pounds.png" /></figure>

<p>You should do a quick scan of the variables in your dataset to identify any fields that could potentially report multiple units so that you can figure out if these conversions are necessary. If they are, you might need to reference an additional field to identify what the original units are that you should be converting from so you know what records need to be changed. If there isn&rsquo;t a specific field that lists the units themselves, other fields like geographic location can be helpful. If you cannot find a field that lets you know what the units are but you suspect that a conversion is necessary, you should contact the original provider of the data to obtain that information. It may turn out that you actually don&rsquo;t need to convert anything and your data are just strange, but it&rsquo;s better to check and make sure than to ignore a potential error in your data.</p>

<p>Another type of conversion that is sometimes less obvious is data type conversion. It is important to make sure that all of the data in a single field is being stored as the same type or your visualization might not appear correctly, depending on how your software interprets the information. For example, &ldquo;80&rdquo; might look like a number to you, but the computer might actually be storing it as a string of text rather than in a numeric form. Some visualization software will go ahead and treat any text that looks like a number as a number, but other software will not. It is a good idea to check that each of your fields (or variables) is stored as a single, specific data type, such as text or numeric. This will ensure that anything that is captured in that field is being treated as the data type that you mean for it to be.</p>

<h3>Controlling for Inconsistencies</h3>

<p>One of the most work-intensive tasks in cleaning data is handling inconsistent information. For example, we see multiple languages popping up in a single dataset more often now that the internet allows us to easily collect data from users all around the world. This can sometimes create problems when you&rsquo;re trying to group things up for visualization purposes, depending on how your data entry form is designed and what data from the set you&rsquo;re using. Perhaps you do a survey of college students and one of the text fields asks for their major. One student might enter &ldquo;Math&rdquo; while another enters &ldquo;Mathematics&rdquo; and another types &ldquo;Applied Mathematics.&rdquo; You know that all these are considered the same major on your campus, but a computer or visualization software would not group these records together. You would need to create a single controlled vocabulary term (e.g. change them all to say &ldquo;Math&rdquo; or &ldquo;Mathematics&rdquo;) or create a separate coded field if you wanted to have them treated as part of the same category.</p>

<figure><img alt="Controlled vocabulary example" src="../images/sections/04/controlled-vocabulary.png" /></figure>

<p>Although the computer can aid in changing values, problems with data inconsistency often have to be handled semi-manually. If you are looking through text fields, much like when you do data coding, find and replace is your best friend. As long as you know what the main variants are of the data that you want to control, you can quickly change them all to be the same value.</p>

<figure><img alt="Find and replace" src="../images/sections/04/find-and-replace.png" /></figure>

<h3>Missing Values</h3>

<p>One of the most frustrating problems is when data fields are simply blank or are incomplete. If data have not been collected, you may be able to return to the source to fill in what is missing, but you may also no longer have access to the source. It may also be possible that you do not know who the source was, for example, in the case of an anonymous survey. If you are not able to obtain the data, it is important to handle the <a class="glossterm" target="_blank" href="glossary01.html#data-missing">missing values</a> correctly. You should set pre-defined values that you can enter in where the missing values would be so when someone looks at your dataset, they know that the data for that field are actually missing and you didn&rsquo;t just forget to type them in.</p>

<p>These values should fall well outside the range of your reasonable data so that they clearly stand for missing data and nothing else. For datasets that do not deal with negative numbers, &ldquo;-9&rdquo; is often used as this default value, at least in the numeric fields. &ldquo;999&rdquo; is another popular choice for datasets that do not use large numbers, and a single period (.) is used by some statistical software programs that may be used with datasets with both negative and large numbers. For text fields, a single dash (-) is commonly used as the indicator for a missing value.</p>

<p>Keep in mind that a missing value is not inherently the same thing as an intentional non-response! You don&rsquo;t have the particular information that the question was asking about in either case, but when someone actively chooses not to answer, that in itself is a piece of data you wouldn&rsquo;t have if the question were unintentionally skipped. Those data aren&rsquo;t missing: you know exactly where they are, the respondent just doesn&rsquo;t want you to have them. As discussed in the <a href="ch03.html">Survey Design chapter</a>, it is good to include a &ldquo;Prefer not to answer&rdquo; option for questions that may be of a personal nature, such as race or ethnicity, income, political affiliation, etc. That way, you can designate a code for this type of response so when you are going through your dataset later on, you know the difference between the respondents that purposely chose not to provide you a given piece of information and the data that are just missing altogether.</p>

<p>It is important to note that for purposes of basic descriptive visualization, missing values are described by including a non-responder category or by noting a change in the sample size. However, in inferential statistics, missing values may be dealt with in a variety of other ways, from exclusion to imputation to full analysis methods like use of EM algorithms.</p>

<figure><img alt="Pie chart comparisons" src="../images/sections/04/do-you-like-pies.png" /></figure>

<h3>Minimizing the Burden of Data Preparation</h3>

<p>The best solutions are preventive. If you are the one creating the form for user input, do whatever you can to prevent receiving data that will require intensive handling during the data preparation stages. In the <a href="ch09.html">Types of Data Checks chapter</a>, we&rsquo;ll talk about different strategies for minimizing the number of data preparation tasks that need to be performed.</p>

<p>If you&rsquo;re not the one collecting the data but can speak with the people who are, try to work with them to identify and resolve any problematic data collection points using the strategies in the Types of Data Checking chapter as a guide.</p>

<h3>Post-Data Preparation</h3>

<p>Once your data are separated into the fields you want, converted into the units and types you intend to work with, and terminology is controlled, you&rsquo;re ready to proceed to the data cleaning phase where you&rsquo;ll check for actual errors in the data. In the next three chapters, we&rsquo;ll talk about the basic process of data cleaning, different processes for performing checks on your data to find problems, and what you can and can&rsquo;t do with data cleaning.</p>

</section>
</section>
